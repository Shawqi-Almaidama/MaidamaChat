import os
from flask import Flask, render_template, request, jsonify
import google.generativeai as genai

# Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ù† Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©
API_KEY = os.getenv("GEMINI_API_KEY")
if not API_KEY:
    raise ValueError("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ API Key")

genai.configure(api_key=API_KEY)

app = Flask(__name__)

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„ØµØ­ÙŠØ­
model = genai.GenerativeModel("models/gemini-1.5-flash")


@app.route("/")
def home():
    return render_template("index.html")

@app.route("/chat", methods=["POST"])
def chat():
    try:
        user_input = request.json.get("message", "").strip()
        if not user_input:
            return jsonify({"error": "Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙØ§Ø±ØºØ©"}), 400

        print(f"âœ… Ø§Ø³ØªÙ„Ø§Ù… Ø±Ø³Ø§Ù„Ø©: {user_input}")

        response = model.generate_content(user_input)
        bot_response = response.text if response.text else "Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø±Ø¯."

        print(f"ğŸ¤– Ø§Ù„Ø±Ø¯: {bot_response}")

        return jsonify({"response": bot_response})

    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ Ø¯Ø§Ø®Ù„ÙŠ: {e}")
        return jsonify({"error": "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø¯Ø§Ø®Ù„ÙŠ"}), 500

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=int(os.getenv("PORT", 8080)))


